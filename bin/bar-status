#!/bin/bash

CMD_PREFIX=~/Projects/chachi-shell/bin/get
PIPE_PREFIX=/tmp/bar-status

COMMANDS="💡-5-brightness
🔋-60-battery
🔉-5-volume
🗓️-1-time"

update_output() {
  all_output=""

  while IFS= read -r line; do
    IFS=- read icon delay name <<< "$line"
    command_output=$(<${PIPE_PREFIX}-${name})
    [ -z "$command_output" ] && exit
    all_output="${all_output} ${icon} ${command_output}"
  done <<< "$COMMANDS"

  echo $all_output
}

run_daemon() {
  while true; do
    ${CMD_PREFIX}-${2} > "${PIPE_PREFIX}-${2}"
    update_output
    sleep $1
  done
}

while IFS= read -r line; do
  IFS=- read icon delay name <<< "$line"
  run_daemon $delay $name &
done <<< "$COMMANDS"

wait
